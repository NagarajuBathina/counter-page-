<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Firebase Counter</title>
    <style>
      body {
        font-family: "Poppins", sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        height: 100vh;
        margin: 0;
        background: linear-gradient(135deg, #6a11cb, #2575fc);
      }
      .counter-container {
        background: white;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        text-align: center;
        margin-bottom: 30px;
      }
      #counter {
        font-size: 3rem;
        margin: 20px 0;
        color: #333;
        font-weight: bold;
      }
      input {
        padding: 10px;
        font-size: 16px;
        width: 120px;
        margin: 5px;
        border-radius: 8px;
        border: 1px solid #ccc;
      }
      button {
        padding: 12px 20px;
        font-size: 18px;
        margin: 10px;
        cursor: pointer;
        border: none;
        border-radius: 8px;
        background: #2575fc;
        color: white;
        transition: all 0.3s;
      }
      button:hover {
        background: #6a11cb;
      }
      table {
        width: 80%;
        border-collapse: collapse;
        margin-top: 20px;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      th,
      td {
        padding: 12px;
        border: 1px solid #ddd;
        text-align: center;
      }
      th {
        background: #2575fc;
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="counter-container">
      <h2>Smart Counter</h2>
      <div id="counter">0</div>
      <input type="number" id="stepValue" placeholder="Enter number" />
      <input type="text" id="noteValue" placeholder="Enter note" />
      <br />
      <button onclick="decrement()">−</button>
      <button onclick="increment()">+</button>
      <button onclick="resetCounter()">Reset</button>
    </div>

    <table id="recordsTable">
      <thead>
        <tr>
          <th>Number</th>
          <th>Note</th>
          <th>Type</th>
          <th>Timestamp</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
      // ✅ Replace with your Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyBWC-oPizA2SPvYqNfK9s_ZDNlW-Ng6N2k",
        authDomain: "soda-b3076.firebaseapp.com",
        projectId: "soda-b3076",
        storageBucket: "soda-b3076.firebasestorage.app",
        messagingSenderId: "258729569728",
        appId: "1:258729569728:web:c3317dbd7962cf7dcdac25",
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      const counterDisplay = document.getElementById("counter");
      const stepInput = document.getElementById("stepValue");
      const noteInput = document.getElementById("noteValue");
      const recordsTableBody = document.querySelector("#recordsTable tbody");

      let counterValue = 0;

      async function loadCounter() {
        const docRef = db.collection("appData").doc("counterDoc");
        const docSnap = await docRef.get();
        if (docSnap.exists) {
          counterValue = docSnap.data().value;
          updateDisplay();
        } else {
          await docRef.set({ value: 0 });
          counterValue = 0;
        }
      }

      function updateDisplay() {
        counterDisplay.textContent = counterValue;
      }

      async function increment() {
        const step = parseInt(stepInput.value) || 1;
        const note = noteInput.value || "N/A";
        counterValue += step;
        await saveCounter("Increment", step, note);
        stepInput.value = "";
        noteInput.value = "";
      }

      async function decrement() {
        const step = parseInt(stepInput.value) || 1;
        const note = noteInput.value || "N/A";
        counterValue -= step;
        await saveCounter("Decrement", step, note);
        stepInput.value = "";
        noteInput.value = "";
      }

      async function resetCounter() {
        counterValue = 0;
        await db.collection("appData").doc("counterDoc").set({ value: 0 });
        updateDisplay();
      }

      async function saveCounter(type, step, note) {
        await db.collection("appData").doc("counterDoc").set({ value: counterValue });
        await db.collection("records").add({
          number: step,
          note: note,
          type: type,
          timestamp: new Date(),
        });
        updateDisplay();
      }

      db.collection("records")
        .orderBy("timestamp", "desc")
        .onSnapshot((snapshot) => {
          recordsTableBody.innerHTML = "";
          snapshot.forEach((doc) => {
            const data = doc.data();
            const row = `<tr>
          <td>${data.number}</td>
          <td>${data.note}</td>
          <td>${data.type}</td>
          <td>${data.timestamp.toDate().toLocaleString()}</td>
        </tr>`;
            recordsTableBody.innerHTML += row;
          });
        });

      // Bind buttons (instead of inline onclick to avoid race)
      document.getElementById("incBtn").addEventListener("click", increment);
      document.getElementById("decBtn").addEventListener("click", decrement);
      document.getElementById("resetBtn").addEventListener("click", resetCounter);

      loadCounter();
    </script>
  </body>
</html>
